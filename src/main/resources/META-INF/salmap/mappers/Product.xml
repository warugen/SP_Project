<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Product">
	<resultMap type="Product" id="ProductResult">
		<result property="pcode" column="pcode" />
		<result property="ptitle" column="ptitle" />
		<result property="pcontent" column="pcontent" />
		<result property="pimage1" column="pimage1" />
		<result property="pimage2" column="pimage2" />
		<result property="pimage3" column="pimage3" />
		<result property="mid" column="mid" />
	</resultMap>
	<select id="getProductList" resultMap="ProductResult">
		<if test="schitem==ptitle">
			SELECT * FROM
			(SELECT ROWNUM RN ,A.* FROM
			(SELECT
			P.*,MNAME,(SELECT COUNT(*) FROM FAVORITE F,PRODUCT P WHERE
			F.PCODE=P.PCODE)FAV FROM PRODUCT P, MARKET M
			WHERE PTITLE LIKE
			'%'||#{schword}||'%' AND P.MID = M.MID ORDER BY FAV
			DESC)A)
			WHERE RN
			BETWEEN #{startRow} AND #{endRow}
		</if>
		<if test="schitem==mname">
			SELECT * FROM
			(SELECT ROWNUM RN ,A.* FROM
			(SELECT
			P.*,MNAME,(SELECT COUNT(*) FROM FAVORITE F,PRODUCT P WHERE
			F.PCODE=P.PCODE)FAV FROM PRODUCT P, MARKET M
			WHERE MNAME LIKE
			'%'||#{schword}||'%' AND P.MID = M.MID ORDER BY FAV DESC)A)
			WHERE RN
			BETWEEN #{startRow} AND #{endRow}
		</if>
		<if test="schitem==all">
			SELECT * FROM
			(SELECT ROWNUM RN ,A.* FROM
			(SELECT
			P.*,MNAME,(SELECT COUNT(*) FROM FAVORITE F,PRODUCT P WHERE
			F.PCODE=P.PCODE)FAV FROM PRODUCT P, MARKET M
			WHERE (PTITLE LIKE '%'||#{schword}||'%' OR MNAME LIKE '%'||#{schword}||'%') 
			AND P.MID = M.MID ORDER BY FAV DESC)A)
			WHERE RN BETWEEN #{startRow} AND #{endRow}
		</if>
	</select>
</mapper>