<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Sp_order">
	<resultMap type="Sp_order" id="Sp_orderResult">
		<result property="ocode" column="ocode" />
		<result property="oname" column="oname" />
		<result property="otel" column="otel" />
		<result property="opost" column="opost" />
		<result property="oaddr1" column="oaddr1" />
		<result property="oaddr2" column="oaddr2" />
		<result property="osum" column="osum" />
		<result property="otime" column="otime" />
		<result property="odelivery" column="odelivery" />
		<result property="ostatus" column="ostatus" />
		<result property="cid" column="cid" />
	</resultMap>
	<select id="orderList" resultMap="Sp_orderResult">
		<if test="schitem==null or schitem==''">
			SELECT * FROM
			(SELECT ROWNUM RN, A.* FROM
			(SELECT
			SP.*,PO.*,ODCODE,CUID,ODCOUNT,ODUNIT FROM SP_ORDER SP, ORDER_DETAIL
			OD, PRODUCT_OPTION PO
			WHERE SP.OCODE=OD.OCODE AND OD.ODCODE=PO.POCODE
			ORDER BY SP.OCODE)A)
			WHERE RN BETWEEN #{startrow} AND #{endrow}
		</if>
		<if test="schitem==poname">
			SELECT * FROM
			(SELECT ROWNUM RN, A.* FROM
			(SELECT
			SP.*,PO.*,ODCODE,CUID,ODCOUNT,ODUNIT FROM SP_ORDER SP, ORDER_DETAIL
			OD, PRODUCT_OPTION PO
			WHERE SP.OCODE=OD.OCODE AND OD.ODCODE=PO.POCODE
			AND PONAME LIKE
			'%'||#{poname}||'%'
			ORDER BY ONAME)A)
			WHERE RN BETWEEN
			#{startrow} AND #{endrow}
		</if>
		<if test="schitem==oname">
			SELECT * FROM
			(SELECT ROWNUM RN, A.* FROM
			(SELECT
			SP.*,PO.*,ODCODE,CUID,ODCOUNT,ODUNIT FROM SP_ORDER SP, ORDER_DETAIL
			OD, PRODUCT_OPTION PO
			WHERE SP.OCODE=OD.OCODE AND OD.ODCODE=PO.POCODE
			AND ONAME LIKE
			'%'||#{oname}||'%'
			ORDER BY ONAME)A)
			WHERE RN BETWEEN
			#{startrow} AND #{endrow}
		</if>
		<if test="schitem==mname">
			SELECT * FROM
			(SELECT ROWNUM RN, A.* FROM
			(SELECT MNAME,
			P.*,PO.POCODE,PONAME,PONET,POPRICE,TYPECODE,ODCODE,OCODE,CUID,ODCOUNT,ODUNIT
			FROM MARKET M, PRODUCT P, PRODUCT_OPTION PO,ORDER_DETAIL OD
			WHERE M.MID = P.MID AND P.PCODE=PO.PCODE AND M.MNAME LIKE '%'||#{mname}||'%'
			ORDER BY MNAME)A)
			WHERE RN BETWEEN #{startrow} AND #{endrow}
		</if>
	</select>
</mapper>
    